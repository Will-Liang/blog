(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{502:function(t,a,s){"use strict";s.r(a);var n=s(2),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"基本介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本介绍"}},[t._v("#")]),t._v(" 基本介绍")]),t._v(" "),a("ol",[a("li",[t._v("根据客户端接收能力不同，SpringBoot 返回不同媒体类型的数据。")]),t._v(" "),a("li",[t._v("比如：客户端 Http 请求 Accept: application/xml 则返回 xml 数据，客户端 Http 请求 Accept: application/json 则返回 json 数据。")]),t._v(" "),a("li",[t._v("如下图：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/springboot/image-20220804102621933.png",alt:"image-20220804102621933"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/springboot/image-20220804103119070.png",alt:"image-20220804103119070"}})]),t._v(" "),a("h2",{attrs:{id:"应用实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用实例"}},[t._v("#")]),t._v(" 应用实例")]),t._v(" "),a("p",[t._v("使用Postman发送Http请求，根据请求头不同，返回对应的json数据或者xml数据，如上图。")]),t._v(" "),a("p",[t._v("修改pom.xml")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 引入支持返回 xml 数据格式 --\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.fasterxml.jackson.dataformat"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("jackson-dataformat-xml"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("使用Postman发出不同的Http Header，可以看到返回对应的数据格式( 测试前，请重启项目)")]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/springboot/image-20220804103112560.png",alt:"image-20220804103112560"}})]),t._v(" "),a("p",[t._v("注释掉pom.xml")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 引入支持返回 xml 数据格式 --\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--<dependency>--\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--    <groupId>com.fasterxml.jackson.dataformat</groupId>--\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--    <artifactId>jackson-dataformat-xml</artifactId>--\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--</dependency>--\x3e")]),t._v("\n")])])]),a("p",[t._v("重新启动项目，修改 Accept再次请求")]),t._v(" "),a("p",[a("code",[t._v("text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/springboot/image-20220804104627484.png",alt:"image-20220804104627484"}})]),t._v(" "),a("p",[t._v("服务器此时不能返回xml数据，但是因为内容协商，没有xml就返回json数据。")]),t._v(" "),a("h2",{attrs:{id:"注意事项和使用细节"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项和使用细节"}},[t._v("#")]),t._v(" 注意事项和使用细节")]),t._v(" "),a("ol",[a("li",[t._v("Postman 可以通过修改 Accept 的值，来返回不同的数据格式。")]),t._v(" "),a("li",[t._v("对于浏览器，我们无法修改其 Accept 的值，怎么办? 解决方案：开启支持基于请求参数 的内容协商功能。")])]),t._v(" "),a("p",[t._v("​\t\t（1）修改 application.yml，开启基于请求参数的内容协商功能。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mvc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# static-path-pattern: /lzwres/**")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hiddenmethod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用了 HiddenHttpMethodFilter,开启页面表单的 Rest 功能")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置视图解析器")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("suffix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .html\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#这里是需要注意 prefix 需要和当前的 static-path-pattern 一致")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("contentnegotiation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("favor-parameter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启基于请求参数的内容协商功能")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果配置了 static-locations，原来的访问路径就被覆盖，如果需要保留，需要再指定一下")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static-locations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/lzwimg/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/META-INF/resources/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                         "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/public/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/static/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/resources/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改静态资源访问的路径")]),t._v("\n\n")])])]),a("p",[a("img",{attrs:{src:"/blog/springboot/image-20220804105317662.png",alt:"image-20220804105317662"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/springboot/image-20220804105305778.png",alt:"image-20220804105305778"}})]),t._v(" "),a("p",[t._v("​\t\t（2）指定一个内容协商的参数名")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mvc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# static-path-pattern: /lzwres/**")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hiddenmethod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用了 HiddenHttpMethodFilter,开启页面表单的 Rest 功能")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("view")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置视图解析器")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("suffix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .html\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" / "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#这里是需要注意 prefix 需要和当前的 static-path-pattern 一致")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("contentnegotiation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("favor-parameter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启基于请求参数的内容协商功能")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parameter-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lzwformat "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定一个内容协商的参数名")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果配置了 static-locations，原来的访问路径就被覆盖，如果需要保留，需要再指定一下")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static-locations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/lzwimg/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/META-INF/resources/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                         "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/public/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/static/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"classpath:/resources/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改静态资源访问的路径")]),t._v("\n\n")])])]),a("p",[a("img",{attrs:{src:"/blog/springboot/image-20220804105626459.png",alt:"image-20220804105626459"}})]),t._v(" "),a("p",[t._v("​\t\t（3）注意，参数 format 是规定好的，在开启请求参数的内容协商功能后，SpringBoot 底层 ParameterContentNegotiationStrategy 会通过 format 来接收参数，然后返回对应的媒体类型/ 数据格式，当然 format=xx 这个 xx 媒体类型/数据格式 是 SpringBoot 可以处理的才行，不能乱写。")])])}),[],!1,null,null,null);a.default=e.exports}}]);